import de.m_marvin.metabuild.core.script.BuildScript;
import de.m_marvin.metabuild.cpp.script.CppMultiTargetBuildScript;
import de.m_marvin.metabuild.maven.tasks.MavenPublishTask;
import de.m_marvin.metabuild.maven.types.Repository;
import de.m_marvin.metabuild.maven.types.Repository.Credentials;

public class Buildfile extends CppMultiTargetBuildScript {
	
	String version = "1.0-SNAPSHOT";
	
	@Override
	public void init() {
		
		projectName = "netsocket";
		
		// Windows AMD 64
		var target = makeTarget("WinAMD64", "netsocket_x64.dll");
		target.compileCpp.compiler = target.linkCpp.linker = "winamd64-g++";
		target.compileCpp.define("PLATFORM_WIN");
		target.compileCpp.options.add("-g");
		target.linkCpp.libraries.add("Ws2_32");
		target.linkCpp.options.add("-shared");

		// Linux AMD 64
//		target = makeTarget("LinAMD64", "netstream_x64.so");
//		target.compileCpp.compiler = target.linkCpp.linker = "linamd64-g++";
//		target.compileCpp.define("PLATFORM_LIN");
//		target.compileCpp.options.add("-g");
//		target.linkCpp.options.add("-shared");
		
		super.init();
		
	}

	@Override
	public void publishing(MavenPublishTask publish, MavenPublishTask publishLocal, String config) {
		
		publishLocal.coordinates("de.m_marvin.serialportaccess:netsocket-" + config.toLowerCase() + ":" + version);
		
//		publish.coordinates("de.m_marvin.serialportaccess:netsocket-" + config.toLowerCase() + ":" + version);
//		publish.repository(new Repository(
//				"GHP [SerialPortAccess]", 
//				"https://maven.pkg.github.com/m-marvin/library-serialportaccess",
//				new Credentials(
//						() -> System.getenv("GITHUB_ACTOR"), 
//						() -> System.getenv("GITHUB_TOKEN")
//				)
//		));
		
	}
	
}